<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Dataset Integration - Vortex</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/ir-black.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/console.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Vortex</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">User Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">Dataset Integration</a>
</li>
                                    
<li>
    <a href="../experiment_file_config/" class="dropdown-item">Experiment File Configuration</a>
</li>
                                    
<li>
    <a href="../hypopt_file_config/" class="dropdown-item">HypOpt File Configuration</a>
</li>
                                    
<li>
    <a href="../pipelines/" class="dropdown-item">Pipelines</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Developer Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../developer-guides/custom_backbone_integration/" class="dropdown-item">Custom Backbone Integration</a>
</li>
                                    
<li>
    <a href="../../developer-guides/custom_model_integration_classification/" class="dropdown-item">Custom Model Integration : Classification</a>
</li>
                                    
<li>
    <a href="../../developer-guides/custom_model_integration_detection/" class="dropdown-item">Custom Model Integration : Detection</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../modules/builtin_dataset/" class="dropdown-item">Built-in Dataset</a>
</li>
                                    
<li>
    <a href="../../modules/logging_provider/" class="dropdown-item">Logging Provider</a>
</li>
                                    
<li>
    <a href="../../modules/augmentation/" class="dropdown-item">Augmentations</a>
</li>
                                    
<li>
    <a href="../../modules/data_loader/" class="dropdown-item">Data Loader</a>
</li>
                                    
<li>
    <a href="../../modules/scheduler/" class="dropdown-item">Learning Rates Scheduler</a>
</li>
                                    
<li>
    <a href="../../modules/train_driver/" class="dropdown-item">Training Driver</a>
</li>
                                    
<li>
    <a href="../../modules/models_zoo/" class="dropdown-item">Models Zoo</a>
</li>
                                    
<li>
    <a href="../../modules/backbones/" class="dropdown-item">Backbones Network</a>
</li>
                                    
<li>
    <a href="../../modules/exporter/" class="dropdown-item">Graph Exporter</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../api/vortex.development.core.pipelines/" class="dropdown-item">vortex.development.core.pipelines</a>
</li>
                                    
<li>
    <a href="../../api/vortex.development.core.factory/" class="dropdown-item">vortex.development.core.factory</a>
</li>
                                    
<li>
    <a href="../../api/vortex.runtime/" class="dropdown-item">vortex.runtime</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="https://github.com/nodefluxio/vortex" class="nav-link">Repository</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../.." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../experiment_file_config/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#dataset-integration" class="nav-link">Dataset Integration</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#directory-structure-standards" class="nav-link">Directory Structure Standards</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#python-module-standards" class="nav-link">Python Module Standards</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#dataset-class-standards" class="nav-link">Dataset Class Standards</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="dataset-integration">Dataset Integration<a class="headerlink" href="#dataset-integration" title="Permanent link">&para;</a></h1>
<p>To integrate external datasets into vortex, you need to follow several standards. This section will describe those standards.</p>
<hr />
<h2 id="directory-structure-standards">Directory Structure Standards<a class="headerlink" href="#directory-structure-standards" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>The dataset directory must be placed under directory <code>external/datasets</code> .  By default, Vortex will search this folder in the current working directory. However, should you place this directory elsewhere, you can set the environment variable VORTEX_DATASET_ROOT so Vortex can find it.</p>
<p>Example :</p>
<pre><code>export VORTEX_DATASET_ROOT = /home/alvinprayuda

/*
Means that the dataset is in /home/alvinprayuda/external/datasets
*/
</code></pre>
<p>So, the directory structure will looked like this</p>
<pre><code>external/
    datasets/
        {dataset-directory}
</code></pre>
</li>
<li>
<p>Each dataset directory must provide a python module <code>/utils/dataset.py</code> which will act as interface</p>
<pre><code>{dataset-directory}/
    utils/
        dataset.py
</code></pre>
</li>
</ul>
<hr />
<h2 id="python-module-standards">Python Module Standards<a class="headerlink" href="#python-module-standards" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>The python module can have several dataset interface classes. However it must be noted that a class represents a dataset. E.g. :</p>
<pre><code>class VOC0712DetectionDataset :
    def __init__(self):
        """
        Implement something here
        """
        pass
</code></pre>
</li>
<li>
<p>All available dataset classes in the <code>utils/dataset.py</code> module must be listed in a variable named <code>supported_datasets</code>. E.g. :</p>
<pre><code>supported_dataset = [
    'VOC0712DetectionDataset'
]

class VOC0712DetectionDataset :
    def __init__(self):
        """
        Implement something here
        """
        pass
</code></pre>
</li>
<li>
<p>The <code>utils/dataset.py</code> interface python module must implement a function <code>create_dataset</code>. This function will receive args from the experiment file. E.g. :</p>
<pre><code>class VOC0712DetectionDataset :
    def __init__(self,*args,**kwargs):
        """
        Implement something here
        """
        pass

def create_dataset(*args, **kwargs) :
    return VOC0712DetectionDataset(*args, **kwargs)
</code></pre>
</li>
</ul>
<hr />
<h2 id="dataset-class-standards">Dataset Class Standards<a class="headerlink" href="#dataset-class-standards" title="Permanent link">&para;</a></h2>
<p>Each dataset class must implement several mandatory method and attributes:</p>
<ul>
<li>
<p>Method <code>__getitem__</code> and <code>__len__</code> similar to <a href="https://pytorch.org/tutorials/beginner/data_loading_tutorial.html#dataset-class">Pytorch dataset implementation</a>:</p>
<ul>
<li>
<p><code>__len__</code> function must return the number (int) of dataset e.g. the number of images. E.g. :</p>
<pre><code>class VOC0712DetectionDataset :
    def __init__(self,*args,**kwargs):
        self.images = ['images/image1.jpg','images/image2.jpg','images/image3.jpg']

    def __len__(self):
        return len(self.images)
</code></pre>
</li>
<li>
<p><code>__getitem__</code> function returned value must be a tuple of image path (str) and its annotations (numpy array). E.g.</p>
<ul>
<li>
<p>Classification task, if you choose not to use <a href="../../modules/builtin_dataset/">torchvision's ImageFolder</a>, the returned target's array dimension is 1</p>
<pre><code>class ImageClassificationDataset :
    def __init__(self,*args,**kwargs):
        self.images = ['images/image1.jpg','images/image2.jpg','images/image3.jpg']
        self.labels = [[0],[2],[1]]

    def __getitem__(self, index):
        img_path = self.images[index]
        target = np.array(self.labels[index])
        return img_path, target

dataset = ImageClassificationDataset()
print(dataset[0][0])
"""
'images/image1.jpg'
"""

print(dataset[0][1])
"""
array([0], dtype=float32)
"""
</code></pre>
</li>
<li>
<p>Detection task, the returned target's array dimension is 2</p>
<pre><code>import numpy as np

class VOC0712DetectionDataset :
    def __init__(self,*args,**kwargs):
        self.images = ['images/image1.jpg','images/image2.jpg','images/image3.jpg']
        self.labels = [
            [[0. , 0.5 , 0.5 , 0.3 , 0.2],[0. , 0.2 , 0.3 , 0.4 , 0.5]],
            [[0. , 0.1 , 0.2 , 0.3 , 0.4]],
            [[1. , 0.7 , 0.5 , 0.2 , 0.3],[2. , 0.4 , 0.4 , 0.3 , 0.3]],
        ]

    def __getitem__(self, index):
        img_path = self.images[index]
        target = np.array(self.labels[index])
        return img_path, target

dataset = VOC0712DetectionDataset()
print(dataset[0][0])
"""
'images/image1.jpg'
"""

print(dataset[0][1])
"""
array([[0. , 0.5, 0.5, 0.3, 0.2],
        [0. , 0.2, 0.3, 0.4, 0.5]], dtype=float32)
    """
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Attribute <code>self.class_names</code> and <code>self.data_format</code></p>
<ul>
<li>
<p><code>self.class_names</code> contains information about class index to string . The value must be a list with string members which the sequence corresponds to its integer class index. The returned class labels in dataset's target must correspond to this list. E.g. </p>
<pre><code>class ImageClassificationDataset :
    def __init__(self,*args,**kwargs):
        self.images = ['images/image1.jpg','images/image2.jpg','images/image3.jpg']
        self.labels = [[0],[2],[1]]
        self.class_names = ['cat','dog','bird']

    def __getitem__(self, index):
        img_path = self.images[index]
        target = np.array(self.labels[index])
        return img_path, target

dataset = ImageClassificationDataset()
print(dataset[0][0])
"""
'images/image1.jpg'
"""

print(dataset[0][1])
"""
array([0], dtype=float32)
"""

class_label = dataset[0][1]
class_label_string_name = dataset.class_names[class_label[0]]
print(class_label_string_name)
"""
'cat'

This means that class_label = 0 correspond to string 'cat' in the self.class_names
"""
</code></pre>
</li>
<li>
<p><code>self.data_format</code> which explains the format of dataset's target array and will be used to extract information from it. This attribute is specifically different between different tasks. Vortex utilizes <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.take.html">numpy.take</a> to slice the information from the dataset's target array. E.g.</p>
<pre><code>"""
Example

self.data_format = {
    'bounding_box' : {
        'indices' : [0, 1, 2, 3],
        'axis' : 1
    },
    'class_label' : {
        'indices' : [4],
        'axis' : 1
    }
}

'indices' : [0, 1, 2, 3] -&gt; indicate x,y,w,h index of bounding box notation
from labels array
'axis' : 1 -&gt; specify the axis in which we slice the labels array

--Example
                            'x'   'y'    'w'   'h'  'class'
target_array=np.array([[ 0.75 , 0.6  , 0.1 , 0.2 ,  8 ]
                        [ 0.5  , 0.22 , 0.3 , 0.4 ,  7 ]])

Using above data format we can slice the array to get only the bounding boxes coords

bbox_array = np.array([[ 0.75 , 0.6 , 0.1 , 0.28]
                        [ 0.5 , 0.22 , 0.3 , 0.4]])

class_array = np.array([[8]
                        [7]])
"""
</code></pre>
<ul>
<li>
<p>Classification Task</p>
<ul>
<li>Class Label Data Format<pre><code>"""
Class label data format
"""
self.data_format = {'class_label' : None}

"""
Because the annotations array size only 1, no need to specify indices and axis
However, `self.data_format` is still mandatory
"""
</code></pre>
</li>
</ul>
</li>
<li>
<p>Detection Task</p>
<ul>
<li>
<p>Class Label Data Format</p>
<pre><code>"""
Class label data format
"""
"""
Option 1

Indicate a single class notation for object detection
"""
self.data_format = {'class_label' : None}

"""
Option 2

Indicate a single-category multi-class notation
"""
self.data_format = {
    'class_label' : {
        'indices' : [4],
        'axis' : 1
    }
}

"""
Option 3 (FUTURE-PLAN,NOT SUPPORTED YET)

Indicate a multi-category multi-class notation
"""
self.data_format = {
    'class_label' : {
        'indices' : [4,5,6],
        'axis' : 1
    }
}

"""
Option 4 (FUTURE-PLAN,NOT SUPPORTED YET)

Indicate a multi-category multi-class notation with sequential long indexes
"""
self.data_format = {
    'class_label' : {
        'indices' : {
            'start' : 4,
            'end' : 6
        },
        'axis' : 1
    }
}

"""
Explanation

'indices' with dict format and keys 'start' and 'end' will be converted to 
indices sequence internally
"""
</code></pre>
</li>
<li>
<p>Bounding Box Data Format</p>
<p>It must be noted that VORTEX utilize <strong>[x,y,w,h]</strong> bounding box format in a <strong>normalized style (range 0 - 1 , [x] and [w] are normalized to image’s width, whereas [y] and [h] normalized to image’s height )</strong></p>
<pre><code>"""
Bounding box data format
"""
self.data_format = {
    'bounding_box' : {
        'indices' : [0, 1, 2, 3],
        'axis' : 1
    },
}
</code></pre>
</li>
<li>
<p>Landmarks (Key Points) Data Format (OPTIONAL)</p>
<p>This data format is 'optional' in the sense that not all detection models that support landmark (key points) prediction. Thus if you want to utilize model that predict landmarks, such as RetinaFace, this data format is mandatory</p>
<p>Landmarks annotation is presented as a 1-dimensional array which has <strong>an even length</strong>. E.g. </p>
<pre><code>[ x1,y1, x2,y2, x3,y3, x4,y4, x5,y5 ]
</code></pre>
<p>The given example means that we have 5 landmarks with the coordinates of <strong>(x1,y1),(x2,y2),(x3,y3),(x4,y4), and (x5,y5) and also in normalized style (range 0 - 1 , [x] are normalized to image’s width, whereas [y] normalized to image’s height )</strong></p>
<pre><code>"""
Landmarks data format
"""
"""
Option 1

Standard implementation
"""
self.data_format = {
    'landmarks' : {
        'indices' : [7,8,9,10,11,12,13,14,15,16],
        'axis' : 1
    }
}

"""
Option 2

With asymmetric keypoint declaration
"""
self.data_format = {
    'landmarks' : {
        'indices' : [7,8,9,10,11,12,13,14,15,16],
        'asymm_pairs' : [[0,1],[3,4]],
        'axis' : 1
    }
}

"""
Option 3

Implementation with long sequences
"""
self.data_format = {
    'landmarks' : {
        'indices' : {
            'start' : 7,
            'end' : 16
        }
        'asymm_pairs' : [[0,1],[3,4]],
        'axis' : 1
    }
}

"""
Explanation

'indices' : [7,8,9,10,11,12,13,14,15,16] or
'indices' : {
    'start' : 7,
    'end' : 16
}

The implementatiom above indicates a sequence of x,y coordinates 
(e.g index 7,9,11,13,15 -&gt; x coordinates ,
index 8,10,12,14,16 -&gt; y coordinates)
Indices length must be even number

'asymm_pairs' : [[0,1],[3,4]]

Indicates asymmetric key points which can be affected by vertical/ horizontal-flip 
data augmentation

For example :

Internally, indices [7,8,9,10,11,12,13,14,15,16] will be converted to
[(7,8),(9,10),(11,12),(13,14),(15,16)] which means that the key points indexes are :

keypoint 0 -&gt; (7,8)
keypoint 1 -&gt; (9,10)
keypoint 2 -&gt; (11,12)
keypoint 3 -&gt; (13,14)
keypoint 4 -&gt; (15,16)

In this example, we follow 5 facial landmarks example in which left and right landmarks
sequence is crucial

keypoint 0 -&gt; (7,8) -&gt; left eye
keypoint 1 -&gt; (9,10) -&gt; right eye
keypoint 2 -&gt; (11,12) -&gt; nose
keypoint 3 -&gt; (13,14) -&gt; left mouth
keypoint 4 -&gt; (15,16) -&gt; right mouth

To handle this, the data format should specify which key points index have asymmetric
relation, in this case keypoint 0-1 and keypoint 3-4,
so we annotate them as in a list as [[0,1],[3,4]]
"""
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
